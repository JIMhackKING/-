C51 COMPILER V9.56.0.0   CLOCK                                                             02/28/2018 22:44:06 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE CLOCK
OBJECT MODULE PLACED IN .\Objects\Clock.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE code\Clock.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\Clock.lst) TABS(2) OBJECT(.\Objects\Clock.obj)

line level    source

   1          /************************************************
   2          功能介绍：带闹钟功能的定时浇花装置
   3          端口：
   4            P0  -->  数码管段位显示
   5            P2.0 ~ P2.3  -->  数码管位码
   6            P1.0  -->  继电器（闹钟响起时为低电平)
   7            P3.2 ~ P3.5  -->  按钮开关
   8          *************************************************/
   9          
  10          #include <stdio.h>
  11          #include "SystemFunc.h"
  12          
  13          /************************************************
  14          常量定义
  15          ************************************************/
  16          sbit output=P1^0;
  17          uint count=0;  // 计数总值
  18          uchar Dis_code[]
  19          ={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};
  20          uchar dis_buff[4];  //数码管显示的所有数字
  21          uchar MODE=0;  // 模式选择，设置闹钟
  22          int time;  // 分为单位时间
  23          int clock[4]={0,5,10,1};  // 第一个实时时间，2个闹钟设置，第三个时浇花时长
  24          bit open;  // 继电器端口开启标志
  25          bit Clock_Status=0;  // 闹钟开关标志
  26          /************************************************/
  27          
  28          void EXT1(void) interrupt 2
  29          {
  30   1        Clock_Status=!Clock_Status;
  31   1        P1=~((char)Clock_Status<<7); 
  32   1      }
  33          
  34          /************************************************
  35          作用：定时器0中断函数，定时时间为分
  36          ************************************************/
  37          void TC0(void) interrupt 1
  38          {
  39   1        // 11.0592MHz 晶振频率 50ms 计数值为 46080
  40   1        TH0=TH0+0x4c;  // 初始化初值
  41   1        TL0=TL0+0x00;
  42   1        count++;
  43   1        if(count==1200)  // 1m
  44   1        {
  45   2          count=0;
  46   2          clock[0]++;
  47   2          if(clock[0]==1440)
  48   2            clock[0]=0;
  49   2        }
  50   1      }
  51          
  52          // 检查时间是否到了闹钟时间
  53          void check_clock(void)
  54          {
C51 COMPILER V9.56.0.0   CLOCK                                                             02/28/2018 22:44:06 PAGE 2   

  55   1        uchar j;
  56   1        for(j=1;j<3;j++)
  57   1        {
  58   2          if(clock[0]==clock[j]&&open==0)
  59   2          {
  60   3            time=clock[0];
  61   3            output=0;
  62   3            open=1;
  63   3          }
  64   2        }
  65   1        if(open)
  66   1        {
  67   2          if(clock[0]-time==clock[3]||clock[0]<time)
  68   2          {
  69   3            output=1;
  70   3            open=0;
  71   3          }
  72   2        }
  73   1      }
  74          
  75          void main(void)
  76          {
  77   1        INT_Init();
  78   1        UART_init();
  79   1        PT0=1;  // 设置定时器0为最高优先级
  80   1        while(1)
  81   1        {
  82   2          Bin2Bcd(clock[MODE]);
  83   2          display();
  84   2          deal_cmd();
  85   2          key_press();
  86   2          if(Clock_Status==0) continue;
  87   2          check_clock();
  88   2        }
  89   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    215    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     27    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
